# 8.6 데이터베이스 관리 시스템

### DBMS란?
다루는 데이터항목이 많아져서, 데이터베이스의 구조가 복잡해진다거나, 유저의 인원수가 늘어나면 개개인이 직접 데이터베이스를 조작하면 데이터의 整合性나 에러가 일어날 가능성이 높아진다. 거기서 데이터베이스를 관리하는 소프트웨어인 DBMS(Database Management System)이 필요하다. DBMS는 데이터베이스를 효율좋게 사용하기 위해, 여러가지 기능을 가지고 있다. 

> 쿼리 실행까지의 순서  
> > 구문해석 : 받은 SQL쿼리를 DBMS가 해석  
> > 최적화 : 쿼리를 제일 효율좋게 실행할 수 있는 방법을 결정  
> > 코드 생성 : 최적화한 방법으로 데이터베이스를 접근하는 코드를 생성  

### 트랜잭션 관리 기능
 어떠한 처리의 도중에 에러가 발생하면 문제가 생기는 일련의 처리를 **트랜잭션** 이라고 함. DBMS는 데이터베이스에 대한 조작이나 처리를 하나하나의 조작단위가 아닌, 트랜잭션 단위로 관리한다.
 트랜잭션처리는 데이터의 일관성을 보장하기 위해 4개의 요소가 필요하다. **ACID요소.**

* Atomicity (원자성) : 트랜잭션은, 데이터베이스에 대하는 갱신처리를 완전히 하던지, 완전히 하지 않던지 를 한다.
* Consistency (일관성) : 트랜잭션은, 처리의 전후로 데이터의 모순이 없고 항상 데이터베이스가 일치해야한다.
* Isolation (독립성) : 복수의 트랜잭션이 동시에 실행되어도, 순번으로 실행시키는 것과 결과가 같아야한다.
* Durability (영속성) : 장애가 발생하여도, 정상종료된 트랜잭션의 결과는 잃지않고 복구할 수 있다.

### 베타제어기능
 DBMS는 데이터베이스를 여러명의 유저들이 공유할 수 있는 것을 전제로 만들어진다. 만약 여러명의 사람이 동시에 같은 데이터를 갱신하려고 한다면, 그것을 막고 데이터의　整合性를 보장하기 위해 배타제어라고 하는 기능을 준비한다.
 베타제어는, 어떠한 데이터를 2번째이후로 접근한 사람은, 최최로 접근한 사람의 트랜잭션 처리가 끝날때 까지 조작이 lock이 걸린다. lock은 점유록과 공유록이 있다.

##### 점유Lock 
	데이터베이스를 갱신할 때 걸리는 록으로, 그 사이 다른 유저는 읽기도 갱신도 할 수 없다. 최초로 록을 건 사람만이 그 데이터의 사용권한을 독점한다.
#### 공유Lock
	데이터베이스를 참조할 때 거는 록. 두 번째이후의 유저도 공유록을 건다면, 데이터의 읽기가 가능하다. 다른 사람이 점유록을 건다거나, 데이터를 갱신하는 것은 할 수 없다.
##### 데드락 DeadLock
	록은 편리하지만, 여러명의 유저가 서로 상호가 록을 걸어, 데이터를 사용할 수 없을 때, 영원히 기다리는 상태에 빠지고 만다. 이것을 데드락이라고 한다. DBMS에서는 데드락을 검지하여 자동으로 해제하는 구조를 가지고 있다.
##### 록의 정도?
	데이터베이스 전체나 테이블, 레코드 등 록을 걸 수 있는 단위. 록을 거는 범위가 작으면 작을 수록, 록해제까지의 대기시간이 짧아진다. 록끼리의 경합(데드락)이 발생할 확률이 줄어든다. 단 록의 수가 늘어나면 메모리의 사용량이 늘어나게되는 디메리트가 있다.
	록의 단위가 크면 다른 트랜잭션의 대기시간이 많아져서 전체적인 스루풋이 좋지 않다.

### Recorvery 기능
 DBMS는 데이터베이스에서 무엇인가 문제가 발생하여 트랜잭션이 정상적으로 종료되지 않았을 때에도, 갱신이력을 이용하여 데이터를 정상적인 상태로 되돌린다. 이러한 조작을 리커버리라고 하며, 데이터의 갱신전후를 기록한 로그파일을 이용하여 되돌린다. 데이터베이스의 장애복구회귀처리는 _Roll forward_ , _Roll back_ 이라고 한다.
##### Roll forward
데이터베이스의 고장 등, 물리적인 장애가 발생했을 떄 하는 리커버리 처리를 롤포워드라고 한다. **백업시점의 상태를 복원**한 후, **로그파일**의 갱신후 정보를 사용하여 장애 발생했을 때의 직전 상태로 복귀시킨다.

##### Roll back

트랜잭션처리 도중에 이상종료했을 때, 데이터베이스의 不整合가 발생하는 등, 논리적인 장애가 발생했을 때 하는 처리를 **롤백**이라고 한다. 로그파일의 갱신전 정보를 이용하여 **트랜잭션의 개시직전의 상태로 돌리는 것.**

### 재편성기능
데이터베이스에 대해 갱신이 반복되면, 데이터의 물리적인 격납위치가 불규칙적으로 되는 등으로 기억효율이 나빠진다. 그것을 복구시켜 액세스효율을 향상시키기 위한것이 재편성기능.

### 인덱스 기능
DBMS에서는 **인덱스** 를 이용하여 데이터의 검색을 고속화하는 기능을 가지고 있다. 색인. 어떠한 데이터가 어디에 있는지 나타내는 목차. 

> Optimizer  
> SQL을 실행할 때 실행시간을 최소화하기 위해 처리 방법을 정하는 DBMS의 기능.   
